<!DOCTYPE html>
<html lang="vi">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <head>
        <title>Đăng Ký</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                background-color: #fcfcfc;
                margin: 0;
                padding: 20px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100vh;
            }
    
            h1 {
                color: #030101;
            }
    
            .container {
                background-color: #b4acac;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                max-width: 400px;
                width: 100%;
                text-align: center;
            }
    
            input[type="text"], input[type="tel"], input[type="password"] {
                width: 100%;
                padding: 10px;
                margin-bottom: 10px;
                border: 1px solid #ccc;
                border-radius: 4px;
                box-sizing: border-box;
            }
    
            button {
                background-color: #551606;
                color: rgb(255, 250, 250);
                padding: 10px 20px;
                margin: 5px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
            }
    
            button:hover {
                background-color: #2a2730;
            }
    
            #formDangKy {
                margin-top: 20px;
                text-align: left;
                font-size: 16px;
                color: #333;
            }
    
            .error {
                color: red;
                font-size: 12px;
                margin-top: -8px; 
                margin-bottom: 10px;
                height: 14px; 
            }
            
            #thongBaoThanhCong {
                display: none;
                color: green;
                font-weight: bold;
            }
            
            #error {
                color: red;
            }
        </style>
    </head>
    <body>
    <div class="container">
        <h1>Đăng ký</h1>
        <form id="formDangKy" action="dangky.php" method="post" onsubmit="return dangKyNguoiDung();">
            Tài khoản: <input name="taiKhoan" type="text" placeholder="Nhập tài khoản..." required>
            <div id="error-taiKhoan" class="error"></div>
        
            Mật khẩu: <input id="matKhau" name="matKhau" type="password" placeholder="Nhập mật khẩu mới..." required autocomplete="new-password">
            <div id="error-matKhau" class="error"></div>
        
            Nhập lại mật khẩu: <input id="xacNhanMatKhau" name="xacNhanMatKhau" type="password" placeholder="Nhập lại mật khẩu..." required>
            <div id="error-xacNhanMatKhau" class="error"></div>
        
            Họ và tên: <input name="hoTen" type="text" placeholder="Nhập họ và tên..." required>
            <div id="error-hoTen" class="error"></div>
        
            Email: <input name="email" type="text" placeholder="Nhập Email..." required>
            <div id="error-email" class="error"></div>
        
            Số điện thoại: <input name="soDienThoai" type="tel" placeholder="Nhập số điện thoại..." required>
            <div id="error-soDienThoai" class="error"></div>
        
            Địa chỉ: <input name="diaChi" type="text" placeholder="Nhập địa chỉ..." required>
            <div id="error-diaChi" class="error"></div>
        
            <label for="showPassword">
                <input type="checkbox" id="showPassword" onclick="togglePassword()"> Hiển thị mật khẩu
            </label>
            <br>
            <button type="submit">Đăng ký</button>
        </form>
        
        <div id="thongBaoThanhCong">Đăng ký thành công!</div>
        <div id="error"></div>
        
    </div>

    <script>
        function dangKyNguoiDung() {
            clearErrors(); // Xóa các thông báo lỗi trước khi gửi
        
            var formData = new FormData(document.getElementById('formDangKy'));
        
            fetch('dangky.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('thongBaoThanhCong').style.display = 'block';
                    document.getElementById('thongBaoThanhCong').innerText = data.message;
                    document.getElementById('formDangKy').reset();
                    setTimeout(() => {
                        window.location.href = "http://localhost/website-py/Graphics/login/DangNhap.html";
                    }, 2000);
                } else {
                    // Hiển thị lỗi cụ thể cho từng trường
                    if (data.errors) {
                        if (data.errors.taiKhoan) {
                            document.getElementById('error-taiKhoan').innerText = data.errors.taiKhoan;
                            clearErrorAfterTimeout('error-taiKhoan');
                        }
                        if (data.errors.matKhau) {
                            document.getElementById('error-matKhau').innerText = data.errors.matKhau;
                            clearErrorAfterTimeout('error-matKhau');
                        }
                        if (data.errors.xacNhanMatKhau) {
                            document.getElementById('error-xacNhanMatKhau').innerText = data.errors.xacNhanMatKhau;
                            clearErrorAfterTimeout('error-xacNhanMatKhau');
                        }
                        if (data.errors.hoTen) {
                            document.getElementById('error-hoTen').innerText = data.errors.hoTen;
                            clearErrorAfterTimeout('error-hoTen');
                        }
                        if (data.errors.email) {
                            document.getElementById('error-email').innerText = data.errors.email;
                            clearErrorAfterTimeout('error-email');
                        }
                        if (data.errors.soDienThoai) {
                            document.getElementById('error-soDienThoai').innerText = data.errors.soDienThoai;
                            clearErrorAfterTimeout('error-soDienThoai');
                        }
                        if (data.errors.diaChi) {
                            document.getElementById('error-diaChi').innerText = data.errors.diaChi;
                            clearErrorAfterTimeout('error-diaChi');
                        }
                    } else {
                        document.getElementById('error').innerText = data.message;
                        clearErrorAfterTimeout('error');
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('error').innerText = "Có lỗi xảy ra khi đăng ký.";
                clearErrorAfterTimeout('error');
            });
        
            return false; 
        }
        
        function clearErrorAfterTimeout(elementId) {
            setTimeout(function() {
                document.getElementById(elementId).innerText = ''; 
            }, 1000);
        }
        
        function clearErrors() {
            document.getElementById('error-taiKhoan').innerText = '';
            document.getElementById('error-matKhau').innerText = '';
            document.getElementById('error-xacNhanMatKhau').innerText = '';
            document.getElementById('error-hoTen').innerText = '';
            document.getElementById('error-email').innerText = '';
            document.getElementById('error-soDienThoai').innerText = '';
            document.getElementById('error-diaChi').innerText = '';
            document.getElementById('error').innerText = '';
        }
        function togglePassword() {
            var matKhau = document.getElementById('matKhau');
            var xacNhanMatKhau = document.getElementById('xacNhanMatKhau');
            var showPassword = document.getElementById('showPassword');
            if (showPassword.checked) {
                matKhau.type = "text"; 
                xacNhanMatKhau.type = "text";
            } else {
                matKhau.type = "password"; 
                xacNhanMatKhau.type = "password";
            }
        }
        
    </script>
    </body>
</html>
